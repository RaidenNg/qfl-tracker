<body style="background: #181c24;">
    <style>
        :root {
            --primary: #00e701;
            --primary-dark: #00b800;
            --surface: #232836;
            --surface-alt: #232836;
            --bg: #181c24;
            --text: #fff;
            --text-secondary: #b3b8c7;
            --border: #232836;
            --accent: #00e701;
            --danger: #ff3b3b;
            --radius: 18px;
            --font-main: 'Inter', 'Poppins', Arial, sans-serif;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .app-section {
            background: var(--surface);
            border-radius: var(--radius);
            margin: 16px 8px 80px 8px;
            padding: 20px 14px 18px 14px;
            box-shadow: 0 2px 12px #0002;
        }
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 18px;
            letter-spacing: 0.5px;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: #181c24;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 14px 0;
            margin: 8px 0;
            width: 100%;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn:active {
            background: var(--primary-dark);
        }
        .btn-danger {
            background: var(--danger);
            color: #fff;
        }
        .btn-small {
            font-size: 0.95rem;
            padding: 8px 0;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: #232836;
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 12px;
            outline: none;
        }
        input:focus, select:focus {
            border: 2px solid var(--primary);
        }
        .wallet-list, .record-list, .stat-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .wallet-item, .record-item, .stat-item {
            background: var(--surface-alt);
            border-radius: 12px;
            margin-bottom: 12px;
            padding: 14px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .wallet-name {
            font-weight: 600;
            color: var(--primary);
        }
        .wallet-amount {
            font-weight: 700;
            font-size: 1.1rem;
        }
        .positive { color: #00e701; }
        .negative { color: #ff3b3b; }
        .nav-bar {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: #232836;
            border-top: 1px solid #232836;
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 64px;
            z-index: 100;
        }
        .nav-btn {
            flex: 1;
            text-align: center;
            color: var(--text-secondary);
            font-size: 1.1rem;
            padding: 8px 0 0 0;
            border: none;
            background: none;
            outline: none;
            cursor: pointer;
            transition: color 0.2s;
        }
        .nav-btn.active, .nav-btn:active {
            color: var(--primary);
        }
        .nav-btn i {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 2px;
        }
        /* Hide scrollbars on mobile */
        ::-webkit-scrollbar { width: 0 !important }
    </style>

    <div id="wallets-section" class="app-section" style="display:block;">
        <div class="section-title">üí∞ Wallets</div>
        <ul class="wallet-list" id="wallets-list"></ul>
        <button class="btn" onclick="showAddWallet()">+ Add Wallet</button>
    </div>

    <div id="records-section" class="app-section" style="display:none;">
        <div class="section-title">üìÖ Records</div>
        <form id="record-form" onsubmit="addRecord(event)">
            <select id="record-wallet"></select>
            <input type="date" id="record-date" required>
            <input type="number" id="record-start" placeholder="Start Amount" step="0.01" required>
            <input type="number" id="record-end" placeholder="End Amount" step="0.01" required>
            <input type="text" id="record-note" placeholder="Notes (optional)">
            <button class="btn" type="submit">Add Record</button>
        </form>
        <ul class="record-list" id="records-list"></ul>
    </div>

    <div id="stats-section" class="app-section" style="display:none;">
        <div class="section-title">üìä Stats</div>
        <ul class="stat-list" id="stats-list"></ul>
        <div class="section-title" style="margin-top:28px;">‚öîÔ∏è Level Up</div>
        <select id="level-difficulty" onchange="updateLevel()">
            <option value="100">Easy ($100/level)</option>
            <option value="250">Medium ($250/level)</option>
            <option value="500">Hard ($500/level)</option>
            <option value="1000">Expert ($1000/level)</option>
        </select>
        <div style="margin:18px 0;">
            <div style="background:#232836;border-radius:12px;height:22px;overflow:hidden;">
                <div id="level-bar" style="height:100%;width:0%;background:linear-gradient(90deg,#00e701,#00bfff,#ff3b3b);transition:width 0.3s;"></div>
            </div>
            <div style="margin-top:6px;text-align:center;">
                <span id="level-label" style="font-weight:600;"></span>
            </div>
        </div>
    </div>

    <div id="data-section" class="app-section" style="display:none;">
        <div class="section-title">üíæ Data</div>
        <button class="btn" onclick="DataManager.saveToFile()"><i class="fas fa-download"></i> Save Data</button>
        <label class="btn" style="margin-top:10px;">
            <i class="fas fa-upload"></i> Load Data
            <input type="file" hidden accept=".json" onchange="DataManager.loadFromFile(this.files[0])">
        </label>
        <div style="margin-top:18px;color:var(--text-secondary);font-size:0.95em;">
            <span id="last-backup"></span>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <button class="nav-btn active" onclick="showSection('wallets')"><i class="fas fa-wallet"></i>Wallets</button>
        <button class="nav-btn" onclick="showSection('records')"><i class="fas fa-history"></i>Records</button>
        <button class="nav-btn" onclick="showSection('stats')"><i class="fas fa-chart-bar"></i>Stats</button>
        <button class="nav-btn" onclick="showSection('data')"><i class="fas fa-save"></i>Data</button>
    </nav>

    <!-- Add Wallet Modal -->
    <div id="wallet-modal" class="modal" style="display:none;">
        <div class="modal-content" style="background:var(--surface);border-radius:16px;">
            <div class="modal-header" style="border:none;">
                <h3 style="color:var(--primary);margin:0;">Add Wallet</h3>
                <span class="close" onclick="closeWalletModal()" style="cursor:pointer;font-size:1.5rem;">&times;</span>
            </div>
            <div class="modal-form">
                <input type="text" id="wallet-name" placeholder="Wallet Name" required>
                <input type="number" id="wallet-amount" placeholder="Initial Amount" step="0.01" required>
                <button class="btn" onclick="addWallet()">Add</button>
            </div>
        </div>
    </div>

    <script>
    // --- State ---
    let wallets = [];
    let records = [];
    let settings = { positionSize: 1, stopLoss: 10 };
    let lastBackup = '';

    // --- Navigation ---
    function showSection(section) {
        ['wallets','records','stats','data'].forEach(s=>{
            document.getElementById(s+'-section').style.display = (s===section) ? 'block' : 'none';
            document.querySelector('.nav-btn.'+(s==='wallets'?'active':'')).classList.remove('active');
        });
        document.querySelectorAll('.nav-btn').forEach(btn=>{
            if(btn.textContent.trim().toLowerCase()===section) btn.classList.add('active');
        });
        if(section==='stats') updateStats();
        if(section==='data') updateBackupLabel();
        if(section==='records') updateRecords();
        if(section==='wallets') updateWallets();
    }

    // --- Wallets ---
    function showAddWallet() {
        document.getElementById('wallet-modal').style.display = 'block';
        setTimeout(()=>{document.getElementById('wallet-name').focus()},200);
    }
    function closeWalletModal() {
        document.getElementById('wallet-modal').style.display = 'none';
        document.getElementById('wallet-name').value = '';
        document.getElementById('wallet-amount').value = '';
    }
    function addWallet() {
        const name = document.getElementById('wallet-name').value.trim();
        const amount = parseFloat(document.getElementById('wallet-amount').value);
        if(!name || isNaN(amount)) return alert('Enter wallet name and amount');
        wallets.push({ id: Date.now(), name, amount });
        closeWalletModal();
        updateWallets();
        saveLocal();
    }
    function deleteWallet(id) {
        if(!confirm('Delete this wallet and all its records?')) return;
        records = records.filter(r=>r.walletId!==id);
        wallets = wallets.filter(w=>w.id!==id);
        updateWallets();
        updateRecords();
        saveLocal();
    }
    function updateWallets() {
        const list = document.getElementById('wallets-list');
        if(wallets.length===0) {
            list.innerHTML = '<li style="color:var(--text-secondary);text-align:center;">No wallets yet</li>';
            return;
        }
        list.innerHTML = wallets.map(w=>`
            <li class="wallet-item">
                <div>
                    <div class="wallet-name">${w.name}</div>
                    <div class="wallet-amount">${w.amount>=0?'<span class="positive">':'<span class="negative">'}$${w.amount.toFixed(2)}</span></div>
                </div>
                <button class="btn btn-danger btn-small" onclick="deleteWallet(${w.id})">Delete</button>
            </li>
        `).join('');
        // Update wallet select in record form
        const sel = document.getElementById('record-wallet');
        sel.innerHTML = wallets.length ? wallets.map(w=>`<option value="${w.id}">${w.name} ($${w.amount.toFixed(2)})</option>`).join('') : '<option value="">No wallets</option>';
    }

    // --- Records ---
    function addRecord(e) {
        e.preventDefault();
        const walletId = parseInt(document.getElementById('record-wallet').value);
        const date = document.getElementById('record-date').value;
        const start = parseFloat(document.getElementById('record-start').value);
        const end = parseFloat(document.getElementById('record-end').value);
        const note = document.getElementById('record-note').value;
        if(!walletId || !date || isNaN(start) || isNaN(end)) return alert('Fill all fields');
        const wallet = wallets.find(w=>w.id===walletId);
        if(start>wallet.amount) return alert('Start amount exceeds wallet balance');
        wallet.amount = wallet.amount - start + end;
        records.push({ id: Date.now(), walletId, date, start, end, profit: end-start, note });
        updateWallets();
        updateRecords();
        saveLocal();
        document.getElementById('record-form').reset();
    }
    function deleteRecord(id) {
        const rec = records.find(r=>r.id===id);
        if(!rec) return;
        if(!confirm('Delete this record?')) return;
        const wallet = wallets.find(w=>w.id===rec.walletId);
        if(wallet) wallet.amount = wallet.amount - rec.end + rec.start;
        records = records.filter(r=>r.id!==id);
        updateWallets();
        updateRecords();
        saveLocal();
    }
    function updateRecords() {
        const list = document.getElementById('records-list');
        if(records.length===0) {
            list.innerHTML = '<li style="color:var(--text-secondary);text-align:center;">No records yet</li>';
            return;
        }
        list.innerHTML = records.slice().reverse().map(r=>{
            const wallet = wallets.find(w=>w.id===r.walletId);
            return `<li class="record-item">
                <div>
                    <div style="font-weight:600;">${r.date} - ${wallet?wallet.name:'?'}</div>
                    <div style="font-size:0.97em;">Start: $${r.start.toFixed(2)} | End: $${r.end.toFixed(2)}</div>
                    <div style="font-size:0.97em;">P/L: <span class="${r.profit>=0?'positive':'negative'}">$${r.profit.toFixed(2)}</span></div>
                    <div style="font-size:0.95em;color:var(--text-secondary);">${r.note||''}</div>
                </div>
                <button class="btn btn-danger btn-small" onclick="deleteRecord(${r.id})">Delete</button>
            </li>`;
        }).join('');
    }

    // --- Stats & Level ---
    function updateStats() {
        const totalBankroll = wallets.reduce((sum,w)=>sum+w.amount,0);
        const totalProfit = records.reduce((sum,r)=>sum+r.profit,0);
        const winRate = records.length ? (records.filter(r=>r.profit>0).length/records.length*100).toFixed(1) : '0.0';
        document.getElementById('stats-list').innerHTML = `
            <li class="stat-item"><span>Total Bankroll</span><span class="${totalBankroll>=0?'positive':'negative'}">$${totalBankroll.toFixed(2)}</span></li>
            <li class="stat-item"><span>Total P/L</span><span class="${totalProfit>=0?'positive':'negative'}">$${totalProfit.toFixed(2)}</span></li>
            <li class="stat-item"><span>Win Rate</span><span>${winRate}%</span></li>
        `;
    }
    function updateLevel() {
        const diff = parseInt(document.getElementById('level-difficulty').value);
        const totalProfit = records.reduce((sum,r)=>sum+r.profit,0);
        const level = Math.floor(Math.abs(totalProfit)/diff);
        const progress = Math.abs(totalProfit)%diff;
        const percent = (progress/diff)*100;
        document.getElementById('level-bar').style.width = percent+'%';
        document.getElementById('level-label').textContent = `Level ${level} (${progress.toFixed(2)}/${diff})`;
        // Color change every 10 levels
        let grad = '#00e701,#00bfff,#ff3b3b';
        if(level>=40) grad='#7e22ce,#d946ef';
        else if(level>=30) grad='#dc2626,#ef4444';
        else if(level>=20) grad='#d97706,#fbbf24';
        else if(level>=10) grad='#059669,#10b981';
        document.getElementById('level-bar').style.background = `linear-gradient(90deg,${grad})`;
    }

    // --- Data Management ---
    const DataManager = {
        saveToFile() {
            try {
                const data = {wallets,records,settings,exportDate:new Date().toISOString()};
                const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bankroll-backup-${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                lastBackup = new Date().toLocaleString();
                updateBackupLabel();
            } catch(e) { alert('Save error: '+e.message); }
        },
        loadFromFile(file) {
            if(!file) return;
            const reader = new FileReader();
            reader.onload = e=>{
                try {
                    const data = JSON.parse(e.target.result);
                    if(!data.wallets||!data.records) throw new Error('Invalid file');
                    wallets = data.wallets;
                    records = data.records;
                    settings = data.settings||settings;
                    lastBackup = new Date().toLocaleString();
                    updateWallets(); updateRecords(); updateStats(); updateLevel();
                    saveLocal();
                    showSection('wallets');
                } catch(e) { alert('Load error: '+e.message); }
            };
            reader.readAsText(file);
        }
    };
    function updateBackupLabel() {
        document.getElementById('last-backup').textContent = lastBackup ? `Last backup: ${lastBackup}` : '';
    }

    // --- Local Storage ---
    function saveLocal() {
        localStorage.setItem('bankrollData',JSON.stringify({wallets,records,settings}));
    }
    function loadLocal() {
        try {
            const data = JSON.parse(localStorage.getItem('bankrollData'));
            if(data) {
                wallets = data.wallets||[];
                records = data.records||[];
                settings = data.settings||settings;
            }
        } catch {}
    }

    // --- Init ---
    window.onload = ()=>{
        loadLocal();
        updateWallets();
        updateRecords();
        updateStats();
        updateLevel();
        showSection('wallets');
    };
    </script>
</body>